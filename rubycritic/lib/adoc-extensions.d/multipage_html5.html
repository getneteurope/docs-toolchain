<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Ruby Critic - Home</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- StyleSheets -->
    <link href="../../assets/stylesheets/bootstrap.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/font-awesome.min.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/prettify.custom_theme.css" media="screen, projection, print" rel="stylesheet" type="text/css">
    <link href="../../assets/stylesheets/application.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  </head>

  <body>
    <header class="navbar navbar-default navbar-fixed-top">
      <a href="#menu-toggle" class="btn btn-default hidden-lg visible-sm-* hidden-md visible-xs-* pull-left" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a>
      <a href="../../overview.html"><img src="../../assets/images/logo.png" alt="Ruby Critic Logo" title="Ruby Critic Logo" width="55"><span class="logo">RUBYCRITIC</span></a>
      
    </header>
    <div id="wrapper">
      <!-- Sidebar -->
      <aside id="sidebar-wrapper">
        <ul class="sidebar-nav">
          <li class="sidebar-item">
            <a href="../../overview.html" class="project-nav-item overview-nav"><i class="fa fa-dashboard"></i>Overview</a>
          </li>
          <li class="sidebar-item">
            <a href="../../code_index.html" class="project-nav-item code-index-nav"><i class="fa fa-code"></i>Code</a>
          </li>
          <li class="sidebar-item">
            <a href="../../smells_index.html" class="project-nav-item smells-index-nav"><i class="fa fa-warning"></i>Smells</a>
          </li>
          <li class="sidebar-item">
            <a href="../../simple_cov_index.html" class="project-nav-item coverage-index-nav"><i class="fa fa-umbrella"></i>Coverage</a>
          </li>
        </ul>
      </aside>
      <!-- /#sidebar-wrapper -->
      <div id="page-content-wrapper">
        <div class="container-fluid">
          <div class="row">
  <!--Page Title -->
  <div class="Page_Title">
    <div class="file-time">
      <span class="committed-at">
        
          Never committed
        
      </span>
    </div>
    <div>
      <h3><small>lib/adoc-extensions.d /</small> multipage_html5.rb</h3>
    </div>
  </div>
  <!--End Page Title -->
  <div class="Content_Wrapper">
    <!-- code detail -->
    <div class="code-top-detail clearfix row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-1">
            <div class="rating f big">
              F
            </div>
          </div>
          <div class="code-statistics col-md-11">
            <div class="col-md-3">
              <div><span class="metric">739</span><small> lines of codes</small></div>
              <div><span class="metric">22</span><small> methods</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">29.1</span><small> complexity/method</small></div>
              <div><span class="metric">0</span><small> churn</small></div>
            </div>
            <div class="col-md-3">
              <div><span class="metric">639.47</span><small> complexity</small></div>
              <div><span class="metric">0</span><small> duplications</small></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="code-tabs">
          <ul class="nav nav-pills right-to-left">
            <li><a href="#" id="toggle-code" class="toggle-button button">code</a></li>
            <li class="active">
              <a href="#" id="toggle-smells" class="toggle-button button">
                45
                smells
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <code class="prettyprint linenums lang-ruby file-code js-file-code"># frozen_string_literal: true

#
# Extends the Html5Converter to generate multiple pages from the document tree.
#
# Features:
#
# - Generates a root (top level) landing page with a list of child sections.
# - Generates branch (intermediate level) landing pages as required, each with
#   a list of child sections.
# - Generates leaf (content level) pages with the actual content.
# - Allows the chunking depth to be configured with the `multipage-level`
#   document attribute (the default is 1—split into chapters).
# - Supports variable chunking depth between sections in the document (by
#   setting the `multipage-level` attribute on individual sections).
# - Uses section IDs to name each page (eg. &quot;introduction.html&quot;).
# - Supports cross-references between pages.
# - Generates a full Table of Contents for each page, but with relevant entries
#   only (the TOC collapses as required for each page).
# - Includes a description for each section on the branch/leaf landing pages
#   (from the `desc` attribute, if set).
# - Generates previous/up/home/next navigation links for each page.
# - Allows the TOC entry for the current page to be styled with CSS.
# - Supports standalone and embedded (--no-header-footer) HTML output.
# - Retains correct section numbering throughout.
#
# Notes and limitations:
#
# - Tested with Asciidoctor 2.0.0; inline anchors in unordered list items
#   require the fix for asciidoctor issue #2812.
# - This extension is tightly coupled with Asciidoctor internals, and future
#   changes in Asciidoctor may require updates here. Hopefully this extension
#   exposes ways in which the Asciidoctor API can be improved.
# - Footnotes are currently not supported.
# - Please contribute fixes and enhancements!
#
# Usage:
#
#   asciidoctor -r ./multipage-html5-converter.rb -b multipage_html5 book.adoc

require &#39;asciidoctor/converter/html5&#39;
require &#39;nokogiri&#39;
require_relative &#39;../utils/create_toc.rb&#39;

# HTML5 Multipage Converter adapted Asciidoctor::AbstractBlock
class Asciidoctor::AbstractBlock<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Asciidoctor::AbstractBlock assumes too much for instance variable '@next_section_index'</span>          </div>  </li></ol>
  # Allow navigation links HTML to be saved and retrieved
  attr_accessor :nav_links<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Asciidoctor::AbstractBlock#nav_links is a writable attribute</span>          </div>  </li></ol>

  # HACK this forces the renumbering of sections and therefore
  # the correction of @next_section_index, which would be
  # inaccurate otherwise and this leads to Nil errors in
  # Asciidoctor core.
  def sections?
    reindex_sections
    @next_section_index &gt; 0
  end
end

# HTML5 Multipage Converter adapted Asciidoctor::AbstractNode
class Asciidoctor::AbstractNode
  # Is this node (self) of interest when generating a TOC for node?
  #
  # Returns true if node is of interest, false otherwise.
  #
  def related_to?(node)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>Asciidoctor::AbstractNode#related_to? has a flog score of 26</span>          </div>  </li></ol>
    return true if level.zero?

    node_tree = []
    current = node
    while current.class != Asciidoctor::Document
      node_tree &lt;&lt; current
      current = current.parent
    end
    if node_tree.include?(self) ||
        node_tree.include?(parent)
      return true
    end

    # If this is a leaf page, include all child sections in TOC
    if node.mplevel == :leaf
      self_tree = []
      current = self
      while current &amp;&amp; current.level &gt;= node.level
        self_tree &lt;&lt; current
        current = current.parent
      end
      return true if self_tree.include?(node)
    end
    return false
  end
end

# HTML5 Multipage Converter adapted Asciidoctor::Document
class Asciidoctor::Document<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Asciidoctor::Document assumes too much for instance variable '@sectnum'</span>          </div>  </li></ol>
  # Allow writing to the :catalog attribute in order to duplicate refs list to
  # new pages
  attr_writer :catalog<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Asciidoctor::Document#catalog is a writable attribute</span>          </div>  </li></ol>

  # Allow the section type to be saved (for when a Section becomes a Document)
  attr_accessor :mplevel<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Asciidoctor::Document#mplevel is a writable attribute</span>          </div>  </li></ol>

  # Allow the current Document to be marked as processed by this extension
  attr_accessor :processed<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Asciidoctor::Document#processed is a writable attribute</span>          </div>  </li></ol>

  # Allow saving of section number for use later. This is necessary for when a
  # branch or leaf Section becomes a Document during chunking and ancestor
  # nodes are no longer accessible.
  attr_writer :sectnum<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Asciidoctor::Document#sectnum is a writable attribute</span>          </div>  </li></ol>

  # Override the AbstractBlock sections?() check to enable the Table Of
  # Contents. This extension may generate short pages that would normally have
  # no need for a TOC. However, we override the Html5Converter outline() in
  # order to generate a custom TOC for each page with entries that span the
  # entire document.
  #
  def sections?
    return !sections.empty?
  end

  # Return the saved section number for this Document object (which was
  # originally a Section)
  #
  def sectnum(delimiter = nil, append = nil)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Unused-Parameters.md" target="_blank"><b>UnusedParameters</b></a>        </span>      </div>      <span>Asciidoctor::Document#sectnum has unused parameter 'append'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Unused-Parameters.md" target="_blank"><b>UnusedParameters</b></a>        </span>      </div>      <span>Asciidoctor::Document#sectnum has unused parameter 'delimiter'</span>          </div>  </li></ol>
    @sectnum
  end
end

# HTML5 Multipage Converter adapted Asciidoctor::Document
class Asciidoctor::Section<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Asciidoctor::Section assumes too much for instance variable '@level'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Asciidoctor::Section assumes too much for instance variable '@mplevel'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Asciidoctor::Section assumes too much for instance variable '@numeral'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>Asciidoctor::Section assumes too much for instance variable '@parent'</span>          </div>  </li></ol>
  # Allow the section type (:root, :branch, :leaf) to be saved for each section
  attr_accessor :mplevel<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Attribute.md" target="_blank"><b>Attribute</b></a>        </span>      </div>      <span>Asciidoctor::Section#mplevel is a writable attribute</span>          </div>  </li></ol>

  # Extend sectnum() to use the Document&#39;s saved sectnum. Document objects
  # normally do not have sectnums, but here Documents are generated from
  # Sections. The sectnum is saved in section() below.
  #
  # Returns the formatted sectnum.
  #
  def sectnum(delimiter = &#39;.&#39;, append = nil)
    append ||= (append == false ? &#39;&#39; : delimiter)
    if @level == 1
      %(#{@numeral}#{append})
    elsif @level &gt; 1
      if @parent.class == Asciidoctor::Section ||
          (@mplevel &amp;&amp; @parent.class == Asciidoctor::Document)
        %(#{@parent.sectnum(delimiter)}#{@numeral}#{append})
      else
        %(#{@numeral}#{append})
      end
    else # @level == 0
      %(#{Asciidoctor::Helpers.int_to_roman @numeral}#{append})
    end
  end
end

# HTML5 Multipage Converter based on HTML5 Converter
class MultipageHtml5Converter &lt; Asciidoctor::Converter::Html5Converter<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Instance-Variable-Assumption.md" target="_blank"><b>InstanceVariableAssumption</b></a>        </span>      </div>      <span>MultipageHtml5Converter assumes too much for instance variable '@catalog'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Too-Many-Instance-Variables.md" target="_blank"><b>TooManyInstanceVariables</b></a>        </span>      </div>      <span>MultipageHtml5Converter has at least 5 instance variables</span>          </div>  </li></ol>
  include Asciidoctor
  include Asciidoctor::Converter
  include Asciidoctor::Writer

  register_for &#39;multipage_html5&#39;

  def initialize(backend, opts = {})
    @xml_mode = false
    @void_element_slash = nil
    super
    @stylesheets = Stylesheets.instance
    @pages = []
  end

  # Add navigation links to the page (from nav_links)
  #
  # Returns nothing.
  #
  def add_nav_links(page)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>MultipageHtml5Converter#add_nav_links doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
    block = Asciidoctor::Block.new(parent = page,
      :paragraph,
      opts = { source: page.nav_links })
    block.add_role(&#39;nav-footer&#39;)
    page &lt;&lt; block
  end

  # Extend Asciidoctor&#39;s convert().
  #
  # Returns transformed node.
  #
  def convert(node, transform = nil, opts = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>MultipageHtml5Converter#convert has a flog score of 43</span>          </div>  </li></ol>
    transform ||= node.node_name
    begin
      opts.empty? ? (send transform, node) : (send transform, node, opts)
    rescue StandardError =&gt; e
      # HACK dirty hack for exception that gets raised when trying &#39;open&#39;,
      # which should be &#39;convert_open&#39; in the first place.
      begin
        transform = &quot;convert_#{node.node_name}&quot;
        opts.empty? ? (send transform, node) : (send transform, node, opts)
      rescue StandardError =&gt; e
        error(&quot;#{e.class}: #{e.message}&quot;)
        error(&quot;#{node}.#{transform}&quot;.bold.red)
        error(&#39;No conversion for node:&#39;.bold.red)
        error(node)
        error(&#39;Exiting.&#39;.bold.red)
        raise e
      end
    end
  end

  # Process Document (either the original full document or a processed page)
  #
  # Returns converted node.
  #
  def document(node)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>MultipageHtml5Converter#document has a flog score of 64</span>          </div>  </li></ol>
    if node.processed
      # This node can now be handled by Html5Converter.
      super
    else
      # This node is the original full document which has not yet been
      # processed; this is the entry point for the extension.

      # Turn off extensions to avoid running them twice.
      # FIXME: DocinfoProcessor, InlineMacroProcessor, and Postprocessor
      # extensions should be retained. Is this possible with the API?
      # Asciidoctor::Extensions.unregister_all

      # Check toclevels and multipage-level attributes
      mplevel = node.document.attr(&#39;multipage-level&#39;, 1).to_i
      toclevels = node.document.attr(&#39;toclevels&#39;, 2).to_i
      if toclevels &lt; mplevel
        logger.warn &#39;toclevels attribute should be &gt;= multipage-level&#39;
      end
      if mplevel &lt; 0
        logger.warn &#39;multipage-level attribute must be &gt;= 0&#39;
        mplevel = 0
      end
      node.document.set_attribute(&#39;multipage-level&#39;, mplevel.to_s)

      # Set multipage chunk types
      set_multipage_attrs(node)

      # Set the &quot;id&quot; attribute for the Document, using the &quot;docname&quot;, which is
      # based on the file name. Then register the document ID using the
      # document title. This allows cross-references to refer to (1) the
      # top-level document itself or (2) anchors in top-level content (blocks
      # that are specified before any sections).
      node.id = node.attributes[&#39;docname&#39;]
      node.register(:refs, [node.id,
        Inline.new(parent = node,
          context = :anchor,
          text = node.doctitle,
          opts = { type: :ref,
            id: node.id }),
        node.doctitle])

      # Generate navigation links for all pages
      generate_nav_links(node)

      # Create and save a skeleton document for generating the TOC lists.
      @@full_outline = new_outline_doc(node)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Class-Variable.md" target="_blank"><b>ClassVariable</b></a>        </span>      </div>      <span>MultipageHtml5Converter declares the class variable '@@full_outline'</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L260" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L478" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L480" class="js-smell-location">2</a>                  </div>  </li></ol>

      # Save the document catalog to use for each part/chapter page.
      @catalog = node.catalog

      # Retain any book intro blocks, delete others, and add a list of sections
      # for the book landing page.
      parts_list = Asciidoctor::List.new(node, :ulist)
      node.blocks.delete_if do |block|
        if block.context == :section
          part = block
          part.convert
          text = %(&lt;&lt;#{part.id},#{part.captioned_title}&gt;&gt;)
          # if desc = block.attr(&#39;desc&#39;) then text &lt;&lt; %( – #{desc}) end
          parts_list &lt;&lt; Asciidoctor::ListItem.new(parts_list, text)
        end
      end
      node &lt;&lt; parts_list

      # Add navigation links
      add_nav_links(node)

      # Mark page as processed and return converted result
      node.processed = true
      node.convert
    end
  end

  # Process Document in embeddable mode (either the original full document or a
  # processed page)
  def embedded(node)
    if node.processed
      # This node can now be handled by Html5Converter.
      super
    else
      # This node is the original full document which has not yet been
      # processed; it can be handled by document().
      document(node)
    end
  end

  # Generate navigation links for all pages in document; save HTML to nav_links
  def generate_nav_links(doc)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>MultipageHtml5Converter#generate_nav_links has a flog score of 40</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>MultipageHtml5Converter#generate_nav_links doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
    pages = doc.find_by(context: :section) do |section|
      %i[root branch leaf].include?(section.mplevel)
    end

    pages.insert(0, doc)
    pages.each do |page|
      page_index = pages.find_index(page)
      links = []
      if page.mplevel != :root
        previous_page = pages[page_index - 1]
        parent_page = page.parent
        home_page = doc
        # NOTE, there are some non-breaking spaces (U+00A0) below.
        links &lt;&lt; %(← &lt;&lt;#{previous_page.id}&gt;&gt;) if previous_page != parent_page
        # links &lt;&lt; %(↑ &lt;&lt;#{parent_page.id}&gt;&gt;)
        # links &lt;&lt; %(⌂ &lt;&lt;#{home_page.id}&gt;&gt;) if home_page != parent_page
      end
      if page_index != pages.length - 1
        next_page = pages[page_index + 1]
        links &lt;&lt; %( &lt;&lt;#{next_page.id}&gt;&gt; →)
      end
      block = Asciidoctor::Block.new(parent = doc,
        context = :paragraph,
        opts = { source: links.join(&#39; | &#39;), subs: :default })
      page.nav_links = block.content
    end
    return
  end

  # Generate the actual HTML outline for the TOC. This method is analogous to
  # Html5Converter outline().
  def generate_outline(node, opts = {})<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>MultipageHtml5Converter#generate_outline has a flog score of 66</span>          </div>  </li></ol>
    # This is the same as Html5Converter outline()
    return unless node.sections?
    return if node.sections.empty?

    sectnumlevels = opts[:sectnumlevels] || (node.document.attr &#39;sectnumlevels&#39;, 3).to_i
    toclevels = opts[:toclevels] || (node.document.attr &#39;toclevels&#39;, 2).to_i
    sections = node.sections
    result = [%(&lt;ul class=&quot;sectlevel#{sections[0].level}&quot;&gt;)]
    sections.each do |section|
      slevel = section.level
      stitle = if section.caption
                 section.captioned_title
               elsif section.numbered &amp;&amp; slevel &lt;= sectnumlevels
                 %(#{section.sectnum} #{section.title})
               else
                 section.title
               end
      stitle = stitle.gsub DropAnchorRx, &#39;&#39; if stitle.include? &#39;&lt;a&#39;

      # But add a special style for current page in TOC
      if section.id == opts[:page_id]
        stitle = %(&lt;span class=&quot;toc-current&quot;&gt;#{stitle}&lt;/span&gt;)
      end

      # And we also need to find the parent page of the target node
      current = section
      current = current.parent until current.mplevel != :content
      parent_chapter = current

      # If the target is the top-level section of the parent page, there is no
      # need to include the anchor.
      link = if parent_chapter.id == section.id
               %(#{parent_chapter.id}.html)
             else
               %(#{parent_chapter.id}.html##{section.id})
             end
      result &lt;&lt; %(&lt;li&gt;&lt;a href=&quot;#{link}&quot;&gt;#{stitle}&lt;/a&gt;)

      # Finish in a manner similar to Html5Converter outline()
      if slevel &lt; toclevels &amp;&amp;
          (child_toc_level = generate_outline section,
            toclevels: toclevels,
            secnumlevels: sectnumlevels,
            page_id: opts[:page_id])
        result &lt;&lt; child_toc_level
      end
      result &lt;&lt; &#39;&lt;/li&gt;&#39;
    end
    result &lt;&lt; &#39;&lt;/ul&gt;&#39;
    result.join LF
  end

  # Include chapter pages in cross-reference links. This method overrides for
  # the :xref node type only.
  def inline_anchor(node)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor has a flog score of 73</span>          </div>  </li></ol>
    if node.type == :xref
      # This is the same as super...
      if (path = node.attributes[&#39;path&#39;])
        attrs = (append_link_constraint_attrs node, node.role ? [%( class=&quot;#{node.role}&quot;)] : []).join<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'node.role' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L393" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L396" class="js-smell-location">1</a>                  </div>  </li></ol>
        text = node.text || path
      else
        attrs = node.role ? %( class=&quot;#{node.role}&quot;) : &#39;&#39;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'node.role' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L393" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L396" class="js-smell-location">1</a>                  </div>  </li></ol>
        unless (text = node.text)
          refid = node.attributes[&#39;refid&#39;]
          if AbstractNode === (ref = (@refs ||= node.document.catalog[:refs])[refid])
            text = (ref.xreftext node.attr(&#39;xrefstyle&#39;)) || %([#{refid}])
          else
            text = %([#{refid}])
          end
        end
      end

      # But we also need to find the parent page of the target node.
      current = node.document.catalog[:refs][node.attributes[&#39;refid&#39;]]
      until current.respond_to?(:mplevel) &amp;&amp; current.mplevel != :content<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Manual-Dispatch.md" target="_blank"><b>ManualDispatch</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor manually dispatches method call</span>          </div>  </li></ol>
        return %(&lt;a href=&quot;#{node.target}&quot;#{attrs}&gt;#{text}&lt;/a&gt;) unless current<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'node.target' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L410" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L418" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L421" class="js-smell-location">2</a>                  <a href="multipage_html5.html#L423" class="js-smell-location">3</a>                  </div>  </li></ol>

        current = current.parent
      end
      parent_page = current

      # If the target is the top-level section of the parent page, there is no
      # need to include the anchor.
      target = if node.target == &quot;##{parent_page.id}&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'node.target' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L410" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L418" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L421" class="js-smell-location">2</a>                  <a href="multipage_html5.html#L423" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'parent_page.id' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L418" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L419" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L420" class="js-smell-location">2</a>                  <a href="multipage_html5.html#L423" class="js-smell-location">3</a>                  </div>  </li></ol>
                 &quot;#{parent_page.id}.html&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'parent_page.id' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L418" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L419" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L420" class="js-smell-location">2</a>                  <a href="multipage_html5.html#L423" class="js-smell-location">3</a>                  </div>  </li></ol>
               elsif parent_page.id.nil? #TODO: investigate why parent_page.id nil<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'parent_page.id' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L418" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L419" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L420" class="js-smell-location">2</a>                  <a href="multipage_html5.html#L423" class="js-smell-location">3</a>                  </div>  </li></ol>
                 &quot;#{node.target}&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'node.target' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L410" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L418" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L421" class="js-smell-location">2</a>                  <a href="multipage_html5.html#L423" class="js-smell-location">3</a>                  </div>  </li></ol>
               else
                 &quot;#{parent_page.id}.html#{node.target}&quot;<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'node.target' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L410" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L418" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L421" class="js-smell-location">2</a>                  <a href="multipage_html5.html#L423" class="js-smell-location">3</a>                  </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>MultipageHtml5Converter#inline_anchor calls 'parent_page.id' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L418" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L419" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L420" class="js-smell-location">2</a>                  <a href="multipage_html5.html#L423" class="js-smell-location">3</a>                  </div>  </li></ol>
               end

      %(&lt;a href=&quot;#{target}&quot;#{attrs}&gt;#{text}&lt;/a&gt;)
    else
      # Other anchor types can be handled as normal.
      super
    end
  end

  # From node, create a skeleton document that will be used to generate the
  # TOC. This is first used to create a full skeleton (@@full_outline) from the
  # original document (for_page=nil). Then it is used for each individual page
  # to create a second skeleton from the first. In this way, TOC entries are
  # included that are not part of the current page, or excluded if not
  # applicable for the current page.
  def new_outline_doc(node, new_parent: nil, for_page: nil)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>MultipageHtml5Converter#new_outline_doc has a flog score of 44</span>          </div>  </li></ol>
    if node.class == Document
      new_document = Document.new([])
      new_document.mplevel = node.mplevel
      new_document.id = node.id
      new_document.set_attr(&#39;sectnumlevels&#39;, node.attr(:sectnumlevels))
      new_document.set_attr(&#39;toclevels&#39;, node.attr(:toclevels))
      new_parent = new_document
      node.sections.each do |section|
        new_outline_doc(section, new_parent: new_parent,
          for_page: for_page)
      end
      # Include the node if either (1) we are creating the full skeleton from the
      # original document or (2) the node is applicable to the current page.
    elsif !for_page ||
        node.related_to?(for_page)
      new_section = Section.new(parent = new_parent,
        level = node.level,
        numbered = node.numbered)
      new_section.id = node.id
      new_section.caption = node.caption
      new_section.title = node.title
      new_section.mplevel = node.mplevel
      new_parent &lt;&lt; new_section
      new_parent.sections.last.numeral = node.numeral
      new_parent = new_section

      node.sections.each do |section|
        new_outline_doc(section, new_parent: new_parent,
          for_page: for_page)
      end
    end
    return new_document
  end

  # Override Html5Converter outline() to return a custom TOC outline
  def outline(node, opts = {})
    doc = node.document
    # Find this node in the @@full_outline skeleton document
    page_node = @@full_outline.find_by(id: node.id).first<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Class-Variable.md" target="_blank"><b>ClassVariable</b></a>        </span>      </div>      <span>MultipageHtml5Converter declares the class variable '@@full_outline'</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L260" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L478" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L480" class="js-smell-location">2</a>                  </div>  </li></ol>
    # Create a skeleton document for this particular page
    custom_outline_doc = new_outline_doc(@@full_outline, for_page: page_node)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Class-Variable.md" target="_blank"><b>ClassVariable</b></a>        </span>      </div>      <span>MultipageHtml5Converter declares the class variable '@@full_outline'</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L260" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L478" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L480" class="js-smell-location">2</a>                  </div>  </li></ol>
    opts[:page_id] = node.id
    # Generate an extra TOC entry for the root page. Add additional styling if
    # the current page is the root page.
    root_file = %(#{doc.attr(&#39;docname&#39;)}#{doc.attr(&#39;outfilesuffix&#39;)})
    root_link = %(&lt;a href=&quot;#{root_file}&quot;&gt;#{doc.doctitle}&lt;/a&gt;)
    classes = [&#39;toc-root&#39;]
    classes &lt;&lt; &#39;toc-current&#39; if node.id == doc.attr(&#39;docname&#39;)
    root = %(&lt;span class=&quot;#{classes.join(&#39; &#39;)}&quot;&gt;#{root_link}&lt;/span&gt;)
    # Create and return the HTML
    %(&lt;p&gt;#{root}&lt;/p&gt;#{generate_outline(custom_outline_doc, opts)})
  end

  # Change node parent to new parent recursively
  def reparent(node, parent)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>MultipageHtml5Converter#reparent has a flog score of 28</span>          </div>  </li></ol>
    node.parent = parent
    if node.context == :dlist
      node.find_by(context: :list_item).each do |block|
        reparent(block, node)
      end
    else
      node.blocks.each do |block|
        reparent(block, node)
        next unless block.context == :table

        block.columns.each do |col|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>MultipageHtml5Converter#reparent contains iterators nested 2 deep</span>          </div>  </li></ol>
          col.parent = col.parent
        end
        block.rows.body.each do |row|
          row.each do |cell|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>MultipageHtml5Converter#reparent contains iterators nested 3 deep</span>          </div>  </li></ol>
            cell.parent = cell.parent
          end
        end
      end
    end
  end

  # Process a Section. Each Section will either be split off into its own page
  # or processed as normal by Html5Converter.
  def section(node)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>VeryHighComplexity</b></a>        </span>      </div>      <span>MultipageHtml5Converter#section has a flog score of 69</span>          </div>  </li></ol>
    doc = node.document
    if doc.processed
      # This node can now be handled by Html5Converter.
      super
    else
      # This node is from the original document and has not yet been processed.

      # Create a new page for this section
      page = ::Asciidoctor::Document.new([],
        attributes: doc.attributes.clone,
        doctype: doc.doctype,
        header_footer: !doc.attr?(:embedded),
        safe: doc.safe)
      # Retain webfonts attribute (why is doc.attributes.clone not adequate?)
      page.set_attr(&#39;webfonts&#39;, doc.attr(:webfonts))
      # Save sectnum for use later (a Document object normally has no sectnum)
      if node.parent.respond_to?(:numbered) &amp;&amp; node.parent.numbered<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Manual-Dispatch.md" target="_blank"><b>ManualDispatch</b></a>        </span>      </div>      <span>MultipageHtml5Converter#section manually dispatches method call</span>          </div>  </li></ol>
        page.sectnum = node.parent.sectnum
      end

      # Process node according to mplevel
      if node.mplevel == :branch
        # Retain any part intro blocks, delete others, and add a list
        # of sections for the part landing page.
        chapters_list = Asciidoctor::List.new(node, :ulist)
        node.blocks.delete_if do |block|
          if block.context == :section
            chapter = block
            chapter.convert
            text = %(&lt;&lt;#{chapter.id},#{chapter.captioned_title}&gt;&gt;)
            # NOTE, there is a non-breaking space (Unicode U+00A0) below.
            if desc = block.attr(&#39;desc&#39;) then text &lt;&lt; %( – #{desc}) end
            chapters_list &lt;&lt; Asciidoctor::ListItem.new(chapters_list, text)
            true
          end
        end
        # Add chapters list to node, reparent node to new page, add
        # node to page, mark as processed, and add page to @pages.
        node &lt;&lt; chapters_list
        reparent(node, page)
        page.blocks &lt;&lt; node
      else # :leaf
        # Reparent node to new page, add node to page, mark as
        # processed, and add page to @pages.
        reparent(node, page)
        page.blocks &lt;&lt; node
      end

      # Add navigation links using saved HTML
      page.nav_links = node.nav_links
      add_nav_links(page)

      # Mark page as processed and add to collection of pages
      @pages &lt;&lt; page
      page.id = node.id
      page.catalog = @catalog
      page.mplevel = node.mplevel
      page.processed = true
    end
  end

  # Add multipage attribute to all sections in node, recursively.
  def set_multipage_attrs(node)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>MultipageHtml5Converter#set_multipage_attrs has a flog score of 38</span>          </div>  </li></ol>
    doc = node.document
    node.mplevel = :root if node.class == Asciidoctor::Document
    node.sections.each do |section|
      if !section.attr?(&#39;multipage-level&#39;)
        section.set_attr(&#39;multipage-level&#39;, node.attr(&#39;multipage-level&#39;))
      end
      # Propogate custom multipage-level value to child node
      if !section.attr?(&#39;multipage-level&#39;, nil, false) &amp;&amp;
          node.attr(&#39;multipage-level&#39;) != doc.attr(&#39;multipage-level&#39;)
        section.set_attr(&#39;multipage-level&#39;, node.attr(&#39;multipage-level&#39;))
      end
      # Set section type
      if section.level &lt; section.attr(&#39;multipage-level&#39;).to_i
        section.mplevel = :branch
      elsif section.level == section.attr(&#39;multipage-level&#39;).to_i
        section.mplevel = :leaf
      else
        section.mplevel = :content
      end
      # Set multipage attribute on child sections now.
      set_multipage_attrs(section)
    end
  end

  # Convert each page and write it to file. Use filenames based on IDs.
  def write(output, target)
    # Write primary (book) landing page
    ::File.open(target, &#39;w&#39;) do |f|
      f.write(output)
    end
    # Write remaining part/chapter pages
    outdir = ::File.dirname(target)
    ext = ::File.extname(target)
    target_name = ::File.basename(target, ext)
    @pages.each do |doc|
      chapter_target = doc.id + ext
      outfile = ::File.join(outdir, chapter_target)
      ::File.open(outfile, &#39;w&#39;) do |f|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>MultipageHtml5Converter#write contains iterators nested 2 deep</span>          </div>  </li></ol>
        f.write(doc.convert)
      end
    end
  end
end

# Table Of Content Injector
#
# Inject the beforehand created Table Of Content into every page,
# including the logo under `images/logo.png` and the search input field.
#
class TableOfContentInjector &lt; Asciidoctor::Extensions::Postprocessor
  def process(document, output)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="http://docs.seattlerb.org/flog/" target="_blank"><b>HighComplexity</b></a>        </span>      </div>      <span>TableOfContentInjector#process has a flog score of 38</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>TableOfContentInjector#process doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
    toc_factory = ::Toolchain::Adoc::CreateTOC.new
    _, toc_html_filepath, _ = toc_factory.run(document)
    toc = File.read(toc_html_filepath)
    html = Nokogiri::HTML(output)

    # filename is based on ID, see `write` method above
    filename = document.id + &#39;.html&#39;
    toc_document = Nokogiri::HTML.fragment(toc)
    toc_document = toc_factory.tick_toc_checkboxes(document.id, toc_document)
    # table of content
    html.at_css(&#39;div#toc&#39;).remove if html.at_css(&#39;div#toc&#39;)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>TableOfContentInjector#process calls 'html.at_css('div#toc')' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L644" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L647" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L653" class="js-smell-location">2</a>                  </div>  </li></ol>
    html.at_css(&#39;body&#39;).children.first.add_previous_sibling(toc_document)
    # logo
    html.at_css(&#39;div#toc&#39;).children.first.add_previous_sibling(<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>TableOfContentInjector#process calls 'html.at_css('div#toc')' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L644" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L647" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L653" class="js-smell-location">2</a>                  </div>  </li></ol>
      &#39;&lt;a id=&quot;logo&quot; href=&quot;index.html&quot;&gt;&lt;img src=&quot;images/logo.png&quot; alt=&quot;Logo&quot;&gt;&lt;/a&gt;&#39;
    )
    # search and search overlay
    search_overlay = File.read(
      File.join(::Toolchain.build_path, &#39;docinfo-search.html&#39;))
    html.at_css(&#39;div#toc&#39;).children.first.add_next_sibling(search_overlay)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Duplicate-Method-Call.md" target="_blank"><b>DuplicateMethodCall</b></a>        </span>      </div>      <span>TableOfContentInjector#process calls 'html.at_css('div#toc')' 4 times</span>              <span>Locations:</span>                  <a href="multipage_html5.html#L644" class="js-smell-location">0</a>                  <a href="multipage_html5.html#L647" class="js-smell-location">1</a>                  <a href="multipage_html5.html#L653" class="js-smell-location">2</a>                  </div>  </li></ol>

    return html.to_html
  end
end

# CodeRay CSS Injector
#
# By default, Asciidoctor will put the CodeRay CSS file in the body
# of the HTML as one of the very last tags.
# In addition, this will only be injected if the page has actual source code on it.
# Given, that we use the page switch functionality to only change the `div#content`
# when clicking on a new subsection, this tag needs to be on every page.
# Only then will every source code block show correctly, even if switching from a page
# without source code.
#
# This class will add the coderay-asciidoctor.css to every document head and
# remove the CSS link tag in the body, if it exists.
#
class CodeRayCSSInjector &lt; Asciidoctor::Extensions::Postprocessor
  # Always add the link tag in the head after the others.
  # Check for the link tag loading coderay-asciidoctor.css and
  # remove it from the body.
  def process(document, output)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Unused-Parameters.md" target="_blank"><b>UnusedParameters</b></a>        </span>      </div>      <span>CodeRayCSSInjector#process has unused parameter 'document'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>CodeRayCSSInjector#process doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
    html = ::Nokogiri::HTML(output)
    coderay_css = &#39;css/coderay-asciidoctor.css&#39;

    # get the coderay CSS if it exists and remove it
    coderay_css_tag = html.at_xpath(&#39;html/body/link&#39;)
    coderay_css_tag.remove if coderay_css_tag

    css_links = html.xpath(&#39;html/head/link&#39;)
    last_css_link = css_links.last
    # only add the link if it&#39;s not already present (index file gets processed twice)
    if (!last_css_link.nil?) &amp;&amp; last_css_link.attr(&#39;href&#39;) != coderay_css
      css_links.last.add_next_sibling(
        &#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;css/coderay-asciidoctor.css&quot;&gt;&#39;
      )
    end

    return html.to_html
  end
end

# CodeRay NVP Highlighter
#
# By default, CodeRay does not highlight url-encoded code sections.
# This PostProcessor will convert any code blocks containing NVP,
# i.e. `code[data-lang=&quot;nvp&quot;]`, into highlighted code, using the
# CodeRay stylesheet.
#
class CodeRayHighlighterNVP &lt; Asciidoctor::Extensions::Postprocessor

  # Find all the NVP code blocks in +output+ and highlight them.
  # The NVP string simply gets wrapped in `span`s with
  # CodeRay classes.
  #
  # The original code block will be replaced with the highlighted version.
  #
  def process(document, output)<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Unused-Parameters.md" target="_blank"><b>UnusedParameters</b></a>        </span>      </div>      <span>CodeRayHighlighterNVP#process has unused parameter 'document'</span>          </div>  </li>  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Utility-Function.md" target="_blank"><b>UtilityFunction</b></a>        </span>      </div>      <span>CodeRayHighlighterNVP#process doesn't depend on instance state (maybe move it to another class?)</span>          </div>  </li></ol>
    html = ::Nokogiri::HTML(output)
    # nvp = html.at_css(&#39;div.tab-wrapper[data-lang=&quot;NVP&quot;] pre.CodeRay &gt; code&#39;)
    nvps = html.css(&#39;code[data-lang=&quot;nvp&quot;]&#39;)
    return output if nvps.nil? || nvps.empty?

    nvps.each do |nvp|
      src = nvp.content.chomp
      markup_src = src.split(&#39;&amp;&#39;).map do |pair|<ol class="nocode errors smells">  <li>    <div class="description">      <div class="heading">        <span>          <i class="fa fa-warning" aria-hidden="true"></i>          <a href="https://github.com/troessner/reek/blob/master/docs/Nested-Iterators.md" target="_blank"><b>NestedIterators</b></a>        </span>      </div>      <span>CodeRayHighlighterNVP#process contains iterators nested 2 deep</span>          </div>  </li></ol>
        key, val = pair.split(&#39;=&#39;)
        %(&lt;span class=&quot;key&quot;&gt;#{key}&lt;/span&gt;&lt;span=&quot;assign&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;value&quot;&gt;#{val}&lt;/span&gt;)
      end.join(&#39;&lt;span class=&quot;connector&quot;&gt;&amp;&lt;/span&gt;&#39;)
      nvp.inner_html = markup_src
    end

    return html.to_html
  end
end



Asciidoctor::Extensions.register do
  if %w[html html5 multipage_html5].any? { |be| @document.basebackend?(be) }
    postprocessor TableOfContentInjector
    postprocessor CodeRayCSSInjector
    postprocessor CodeRayHighlighterNVP
  end
end
</code>
  </div>
</div>

        </div>
      </div>
    </div>

    <!-- JavaScripts -->
    <script src='../../assets/javascripts/jquery.min.js'></script>
    <script src='../../assets/javascripts/jquery.tablesorter.min.js'></script>
    <script src='../../assets/javascripts/jquery.scrollTo.min.js'></script>
    <script src='../../assets/javascripts/jquery.timeago.js'></script>
    <script src='../../assets/javascripts/highcharts.src-4.0.1.js'></script>
    <script src='../../assets/javascripts/prettify.js'></script>
    <script src='../../assets/javascripts/bootstrap.min.js'></script>
    <script src='../../assets/javascripts/application.js'></script>
    <script src='../../assets/javascripts/jquery.filtertable.min.js'></script>
  </body>
</html>
